# restore-workflow-test-timings action

The `restore-workflow-test-timings` action restores the test timing reports generated by a previous CI run.

These files, using the JUnit xml format, can then be processed by the `split-tests` action, to better distribute the test files between the jobs.

## How does it work

At the end of a CI run, the workflow is expected to save its test timing reports using the `save-workflow-test-timings` action.

Then, at the start of the next CI run, the `restore-workflow-test-timings` action looks up the cache, and attempts to restore the test timing reports of a previous run.

The cache entry has several fallbacks: if cached test timings for the current commit cannot be found, the action will attempt to find cached timings for the current branch, or in last resort for any branch of the repo.

## Inputs

The action takes two parameters:

- `pattern` (optional): the glob pattern of the test timings report, using the JUnit xml file format.

## Usage

The `restore-workflow-test-timings` action must be run on each job. It can be run at any time, but must be executed before the `split-tests` action.

```yaml
jobs:
  tests:
    strategy:
      matrix:
        runners: [ 0, 1, 2, 3 ]
    steps:
      - name: 'Restore tests reports of a previous run'
        uses: enercoop/split-tests/restore-workflow-test-timings@v1
        with:
          pattern: 'tmp/*.junit.xml'

      - name: 'Determine the subset of test files to be run'
        uses: enercoop/split-tests@v1
        id: split-tests
        with:
          pattern: 'spec/**'
          junit-pattern: 'tmp/*.junit.xml'
          job-index : ${{ strategy.job-index }}
          job-total : ${{ strategy.job-total }}
```
